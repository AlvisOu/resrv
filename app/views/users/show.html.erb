<h1>Hi, <%= @user.name %>!</h1>

<p><strong>Email:</strong> <%= @user.email %></p>

<hr>

<h2>Penalties by Workspace</h2>

<% if @workspace_penalties.any? %>
  <% @workspace_penalties.each do |workspace, penalties| %>
    <div class="mb-3">
      <h4><%= workspace.name %></h4>
      <ul class="list-group">
        <% penalties.each do |penalty| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>
              <strong><%= penalty.reason.titleize %></strong>
              — expires <%= penalty.expires_at.strftime("%b %d, %Y %I:%M %p") %>
              <% if penalty.appeal_pending? %>
                <span class="badge bg-warning text-dark ms-2">Appeal pending</span>
              <% elsif penalty.appeal_state == "resolved" %>
                <span class="badge bg-success ms-2">Appeal reviewed</span>
              <% end %>
              <% if penalty.appeal_message.present? %>
                <div class="text-muted" style="font-size: 0.9em;">Your note: "<%= penalty.appeal_message %>"</div>
              <% end %>
            </span>
            <% if penalty.appeal_state == "none" %>
              <%= form_with url: appeal_penalty_path(penalty), method: :post, local: true, style: "display:flex; align-items:center; gap:10px; margin:0; flex-wrap:nowrap;" do %>
                <%= text_field_tag :appeal_message, nil, placeholder: "Optional note", class: "form-control form-control-sm", style: "width:240px; display:inline-block; flex:0 0 auto;" %>
                <%= submit_tag "Appeal", class: "btn btn-sm btn-outline-primary", style: "flex:0 0 auto; margin:0;" %>
              <% end %>
            <% elsif penalty.appeal_state == "resolved" %>
              <span class="text-muted" style="font-size: 0.9em;">Owner has already reviewed this penalty.</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% else %>
  <p class="text-muted">You have no active penalties in any workspace.</p>
<% end %>

<hr>

<h2>Edit Profile</h2>

<%= form_with model: @user, url: profile_path, method: :patch do |f| %>
  <div class="mt-3">
    <%= f.label :name, "Update Name" %><br>
    <%= f.text_field :name %>
  </div>

  <div class="mt-3">
    <%= f.label :password, "New Password" %><br>
    <%= f.password_field :password %>
  </div>

  <div class="mt-3">
    <%= f.label :password_confirmation, "Confirm New Password" %><br>
    <%= f.password_field :password_confirmation %>
  </div>

  <div class="mt-3">
    <%= f.submit "Update Profile" %>
  </div>
<% end %>

<hr>

<h2>Delete Profile</h2>

<%= button_to "Delete My Account", user_path(@user), method: :delete, data: { confirm: "Are you sure you want to delete your account? This cannot be undone." }, class: "button danger" %>

<hr>

<div class="text-center mt-3">
  <%= link_to "← Back to Workspaces", workspaces_path, class: "btn btn-secondary" %>
</div>
