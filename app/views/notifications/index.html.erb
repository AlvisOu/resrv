<div class="row justify-content-center">
  <div class="col-lg-10">
    <style>
      .notifications-card {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      }
      .notifications-toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      .notifications-toolbar .title {
        font-weight: 700;
        color: #334155;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        font-size: 12px;
      }
      .notifications-toolbar .hint { margin: 0; color: #94a3b8; font-size: 13px; }
      .notification-list { margin: 0; padding: 0; }
      .notification-row {
        display: flex;
        gap: 14px;
        padding: 18px 20px;
        border-bottom: 1px solid #e5e7eb;
        align-items: flex-start;
      }
      .notification-row:last-child { border-bottom: none; }
      .notification-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-top: 8px;
        background: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59,130,246,0.12);
      }
      .notification-row.is-read .notification-dot {
        background: #cbd5e1;
        box-shadow: none;
      }
      .notification-body { flex: 1; min-width: 0; }
      .notification-top {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: center;
      }
      .notification-title {
        font-weight: 700;
        color: #0f172a;
        font-size: 17px;
        line-height: 1.4;
        margin: 0;
      }
      .notification-row.is-read .notification-title { color: #475569; font-weight: 600; }
      .notification-time { color: #94a3b8; font-size: 13px; white-space: nowrap; }
      .notification-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
        flex-wrap: wrap;
      }
      .notification-penalty { margin-top: 12px; }
    </style>

    <div class="d-flex align-items-center mb-4">
      <h1 class="h3 mb-0 mr-3">Notifications</h1>
      <% unread_count = @notifications.count { |n| !n.read } %>
      <% if unread_count > 0 %>
        <span class="badge badge-pill badge-primary"><%= unread_count %> unread</span>
      <% end %>
    </div>

    <% if @notifications.any? %>
      <div class="notifications-card">
        <div class="notifications-toolbar">
          <div>
            <div class="title">Recent Activity</div>
            <p class="hint mb-0">Mark read or clear to keep things tidy.</p>
          </div>
          <div class="btn-group" style="gap: 8px;">
            <%= button_to mark_all_as_read_notifications_path, method: :post, class: "btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center" do %>
              Mark All Read
            <% end %>
            <%= button_to delete_all_notifications_path, method: :delete, data: { confirm: "Are you sure you want to delete all notifications?" }, class: "btn btn-outline-danger btn-sm d-flex align-items-center justify-content-center" do %>
              Clear All
            <% end %>
          </div>
        </div>

        <div class="notification-list">
          <% @notifications.each do |note| %>
            <div class="notification-row <%= 'is-read' if note.read %>">
              <div class="notification-dot"></div>
              <div class="notification-body">
                <div class="notification-top">
                  <h5 class="notification-title <%= 'text-muted' if note.read %>"><%= note.message %></h5>
                  <div class="notification-time"><%= note.created_at.strftime('%b %d, %I:%M %p') %></div>
                </div>

                <% if note.penalty.present? %>
                  <% penalty = note.penalty %>
                  <div class="alert alert-warning mt-2 mb-3 p-3 border-warning notification-penalty">
                    <div class="d-flex align-items-center mb-2">
                      <i class="fas fa-exclamation-triangle mr-2 text-warning"></i>
                      <strong class="text-dark">Penalty: <%= penalty.reason.humanize %></strong>
                    </div>
                    <% if penalty.expires_at.present? %>
                      <div class="small text-muted mb-1">Expires: <%= penalty.expires_at.strftime('%b %d, %Y %I:%M %p') %></div>
                    <% end %>
                    <% if penalty.appeal_message.present? %>
                      <div class="small text-muted">Appeal note: "<%= penalty.appeal_message %>"</div>
                    <% end %>

                    <% if penalty.appeal_pending? && penalty.workspace.present? && current_user_is_owner?(penalty.workspace) %>
                      <div class="mt-3 pt-3 border-top border-warning">
                        <div class="d-flex flex-wrap align-items-center gap-2">
                          <%= form_with url: shorten_penalty_path(penalty), method: :patch, local: true, class: "form-inline mr-2" do %>
                            <div class="input-group input-group-sm">
                              <input type="number" name="shorten_hours" id="shorten_hours_<%= penalty.id %>" min="1" class="form-control" placeholder="Hours" style="width: 80px;">
                              <div class="input-group-append">
                                <button type="submit" class="btn btn-outline-primary">Shorten</button>
                              </div>
                            </div>
                          <% end %>

                          <%= button_to forgive_penalty_path(penalty),
                                        method: :patch,
                                        class: "btn btn-sm btn-danger",
                                        data: { confirm: "Remove this penalty for #{penalty.user.name}?" } do %>
                            Remove Penalty
                          <% end %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% end %>

                <div class="notification-actions">
                  <% unless note.read %>
                    <%= button_to mark_as_read_notification_path(note), method: :post, class: "btn btn-sm btn-outline-primary d-flex align-items-center justify-content-center" do %>
                      Mark as Read
                    <% end %>
                  <% end %>
                  
                  <%= button_to notification_path(note),
                                method: :delete,
                                class: "btn btn-sm btn-outline-secondary d-flex align-items-center justify-content-center" do %>
                    Delete
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="text-center py-5 bg-white rounded shadow-sm">
        <div class="mb-3 text-muted" style="font-size: 3rem;">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
        </div>
        <h5 class="text-muted">No notifications</h5>
        <p class="text-muted small">You're all caught up!</p>
      </div>
    <% end %>
  </div>
</div>
